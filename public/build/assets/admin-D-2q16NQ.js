class l{constructor(){this.init()}init(){this.bindEvents(),this.updateStats()}loadWeeklyCharts(){fetch("/admin/dashboard/weekly-chart",{method:"GET",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),"X-Requested-With":"XMLHttpRequest"}}).then(e=>e.ok?e.json():Promise.reject("API Error")).then(e=>{this.renderActiveUsersChart(e),this.renderOrderedProductsChart(e),this.renderNewOrdersChart(e),this.renderNewFeedbacksChart(e)}).catch(e=>{console.error("Failed to load chart data:",e),this.showChartError()})}renderActiveUsersChart(e){const t=document.getElementById("activeUsersChart");t&&new Chart(t,{type:"line",data:{labels:e.days,datasets:[{label:"Active Users",data:e.activeUsers,borderColor:"#B88E2F",backgroundColor:"rgba(184, 142, 47, 0.1)",borderWidth:3,fill:!0,tension:.4,pointBackgroundColor:"#B88E2F",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:5}]},options:this.getChartOptions()})}renderOrderedProductsChart(e){const t=document.getElementById("orderedProductsChart");t&&new Chart(t,{type:"line",data:{labels:e.days,datasets:[{label:"Products Ordered",data:e.orderedProducts,borderColor:"#28a745",backgroundColor:"rgba(40, 167, 69, 0.1)",borderWidth:3,fill:!0,tension:.4,pointBackgroundColor:"#28a745",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:5}]},options:this.getChartOptions()})}renderNewOrdersChart(e){const t=document.getElementById("newOrdersChart");t&&new Chart(t,{type:"line",data:{labels:e.days,datasets:[{label:"New Orders",data:e.newOrders,borderColor:"#17a2b8",backgroundColor:"rgba(23, 162, 184, 0.1)",borderWidth:3,fill:!0,tension:.4,pointBackgroundColor:"#17a2b8",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:5}]},options:this.getChartOptions()})}renderNewFeedbacksChart(e){const t=document.getElementById("newFeedbacksChart");t&&new Chart(t,{type:"line",data:{labels:e.days,datasets:[{label:"New Feedbacks",data:e.newFeedbacks,borderColor:"#fd7e14",backgroundColor:"rgba(253, 126, 20, 0.1)",borderWidth:3,fill:!0,tension:.4,pointBackgroundColor:"#fd7e14",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:5}]},options:this.getChartOptions()})}getChartOptions(){return{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{grid:{display:!1},ticks:{color:"#666",font:{size:12}}},y:{beginAtZero:!0,grid:{color:"rgba(0,0,0,0.05)"},ticks:{color:"#666",font:{size:12}}}},elements:{point:{hoverRadius:8}},interaction:{intersect:!1,mode:"index"}}}showChartError(){["activeUsersChart","orderedProductsChart","newOrdersChart","newFeedbacksChart"].forEach(t=>{const n=document.getElementById(t);n&&(n.style.display="flex",n.style.alignItems="center",n.style.justifyContent="center",n.innerHTML='<div style="color: #666; text-align: center;"><i class="fas fa-chart-line" style="font-size: 24px; margin-bottom: 8px; display: block;"></i>Unable to load chart data</div>')})}bindEvents(){document.addEventListener("click",e=>{const t=e.target.closest("button[data-modal]");if(t){e.preventDefault();const n=t.getAttribute("data-modal");this.openModal(n)}}),document.addEventListener("click",e=>{const t=document.querySelector(".user-dropdown");e.target.closest(".user-dropdown")?t&&t.classList.toggle("active"):t&&t.classList.remove("active")}),document.addEventListener("click",e=>{e.target.classList.contains("modal")&&e.target.classList.remove("active")}),document.addEventListener("click",e=>{e.target.closest(".logout-btn")&&(confirm("Are you sure you want to log out?")||e.preventDefault())}),document.querySelectorAll("form").forEach(e=>{e.addEventListener("submit",this.handleFormSubmit.bind(this))}),setInterval(()=>this.updateStats(),3e4)}handleFormSubmit(e){}openModal(e){const t=document.getElementById(e);t&&(t.classList.add("active"),setTimeout(()=>{typeof imageEnlargement<"u"&&imageEnlargement.reinitialize()},100))}closeModal(e){const t=document.getElementById(e);t&&t.classList.remove("active")}updateStats(){!window.location.pathname.includes("/admin")||window.location.pathname.includes("/users")||window.location.pathname.includes("/products")||fetch("/admin/dashboard/stats").then(e=>e.json()).then(e=>{const t=document.querySelectorAll(".stat-card");if(t.length>=6&&e){const n=t[0].querySelector(".stat-number");n&&e.total_users!==void 0&&(n.textContent=e.total_users.toLocaleString());const o=t[1].querySelector(".stat-number");o&&e.total_categories!==void 0&&(o.textContent=e.total_categories.toLocaleString());const a=t[2].querySelector(".stat-number");a&&e.total_products!==void 0&&(a.textContent=e.total_products.toLocaleString());const s=t[3].querySelector(".stat-number");s&&e.total_orders!==void 0&&(s.textContent=e.total_orders.toLocaleString());const i=t[4].querySelector(".stat-number");i&&e.total_feedbacks!==void 0&&(i.textContent=e.total_feedbacks.toLocaleString())}}).catch(e=>{document.querySelectorAll(".stat-number").forEach(n=>{const o=parseInt(n.textContent.replace(/,/g,""));if(!isNaN(o)){const a=Math.floor(Math.random()*3)-1,s=Math.max(0,o+a);n.textContent=s.toLocaleString()}})})}logout(){}}function c(r){window.location.href=`/language/${r}`}const u=50;function d(){window.adminPanel&&typeof window.adminPanel.loadWeeklyCharts=="function"?window.adminPanel.loadWeeklyCharts():setTimeout(d,u)}class m{constructor(){this.init()}init(){this.bindEvents()}bindEvents(){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{this.initImageEnlargement(),this.bindModalEvents()}):(this.initImageEnlargement(),this.bindModalEvents())}bindModalEvents(){const t=()=>{const n=document.getElementById("imageEnlargeModal");n?n.addEventListener("click",o=>{o.target===n&&this.closeModal()}):setTimeout(t,100)};t(),document.addEventListener("keydown",n=>{n.key==="Escape"&&this.closeModal()})}initImageEnlargement(){document.querySelectorAll(".clickable-image").forEach(t=>{t.removeEventListener("click",this.boundEnlargeImage),this.boundEnlargeImage||(this.boundEnlargeImage=this.enlargeImage.bind(this)),t.addEventListener("click",this.boundEnlargeImage)})}enlargeImage(e){const t=e.target,n=document.getElementById("enlargedImage"),o=document.getElementById("imageEnlargeModal");if(!n||!o){console.error("Image enlarge modal elements not found");return}n.src=t.src,n.alt=t.alt||"Enlarged Image",o.classList.add("active"),document.body.style.overflow="hidden"}closeModal(){const e=document.getElementById("imageEnlargeModal");e&&(e.classList.remove("active"),document.body.style.overflow="auto")}reinitialize(){this.initImageEnlargement()}}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".lang-option").forEach(r=>{r.addEventListener("click",e=>{e.preventDefault();const t=e.target.closest(".lang-option").getAttribute("data-lang");c(t)})}),window.adminPanel=new l,window.imageEnlargement=new m,window.loadWeeklyCharts=d});
