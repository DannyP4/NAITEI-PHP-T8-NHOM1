class l{constructor(){this.init()}init(){this.bindEvents(),this.updateStats()}loadWeeklyCharts(){fetch("/admin/dashboard/weekly-chart",{method:"GET",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),"X-Requested-With":"XMLHttpRequest"}}).then(t=>t.ok?t.json():Promise.reject("API Error")).then(t=>{this.renderActiveUsersChart(t),this.renderOrderedProductsChart(t),this.renderNewOrdersChart(t),this.renderNewFeedbacksChart(t)}).catch(t=>{console.error("Failed to load chart data:",t),this.showChartError()})}renderActiveUsersChart(t){const e=document.getElementById("activeUsersChart");e&&new Chart(e,{type:"line",data:{labels:t.days,datasets:[{label:"Active Users",data:t.activeUsers,borderColor:"#B88E2F",backgroundColor:"rgba(184, 142, 47, 0.1)",borderWidth:3,fill:!0,tension:.4,pointBackgroundColor:"#B88E2F",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:5}]},options:this.getChartOptions()})}renderOrderedProductsChart(t){const e=document.getElementById("orderedProductsChart");e&&new Chart(e,{type:"line",data:{labels:t.days,datasets:[{label:"Products Ordered",data:t.orderedProducts,borderColor:"#28a745",backgroundColor:"rgba(40, 167, 69, 0.1)",borderWidth:3,fill:!0,tension:.4,pointBackgroundColor:"#28a745",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:5}]},options:this.getChartOptions()})}renderNewOrdersChart(t){const e=document.getElementById("newOrdersChart");e&&new Chart(e,{type:"line",data:{labels:t.days,datasets:[{label:"New Orders",data:t.newOrders,borderColor:"#17a2b8",backgroundColor:"rgba(23, 162, 184, 0.1)",borderWidth:3,fill:!0,tension:.4,pointBackgroundColor:"#17a2b8",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:5}]},options:this.getChartOptions()})}renderNewFeedbacksChart(t){const e=document.getElementById("newFeedbacksChart");e&&new Chart(e,{type:"line",data:{labels:t.days,datasets:[{label:"New Feedbacks",data:t.newFeedbacks,borderColor:"#fd7e14",backgroundColor:"rgba(253, 126, 20, 0.1)",borderWidth:3,fill:!0,tension:.4,pointBackgroundColor:"#fd7e14",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:5}]},options:this.getChartOptions()})}getChartOptions(){return{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{grid:{display:!1},ticks:{color:"#666",font:{size:12}}},y:{beginAtZero:!0,grid:{color:"rgba(0,0,0,0.05)"},ticks:{color:"#666",font:{size:12}}}},elements:{point:{hoverRadius:8}},interaction:{intersect:!1,mode:"index"}}}showChartError(){["activeUsersChart","orderedProductsChart","newOrdersChart","newFeedbacksChart"].forEach(e=>{const o=document.getElementById(e);o&&(o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="center",o.innerHTML='<div style="color: #666; text-align: center;"><i class="fas fa-chart-line" style="font-size: 24px; margin-bottom: 8px; display: block;"></i>Unable to load chart data</div>')})}bindEvents(){document.addEventListener("click",t=>{const e=t.target.closest("button[data-modal]");if(e){t.preventDefault();const o=e.getAttribute("data-modal");this.openModal(o)}}),document.addEventListener("click",t=>{const e=document.querySelector(".user-dropdown");t.target.closest(".user-dropdown")?e&&e.classList.toggle("active"):e&&e.classList.remove("active")}),document.addEventListener("click",t=>{t.target.classList.contains("modal")&&t.target.classList.remove("active")}),document.addEventListener("click",t=>{t.target.closest(".logout-btn")&&(confirm("Are you sure you want to log out?")||t.preventDefault())}),document.querySelectorAll("form").forEach(t=>{t.addEventListener("submit",this.handleFormSubmit.bind(this))}),setInterval(()=>this.updateStats(),3e4)}handleFormSubmit(t){}openModal(t){const e=document.getElementById(t);e&&e.classList.add("active")}closeModal(t){const e=document.getElementById(t);e&&e.classList.remove("active")}updateStats(){!window.location.pathname.includes("/admin")||window.location.pathname.includes("/users")||window.location.pathname.includes("/products")||fetch("/admin/dashboard/stats").then(t=>t.json()).then(t=>{const e=document.querySelectorAll(".stat-card");if(e.length>=6&&t){const o=e[0].querySelector(".stat-number");o&&t.total_users!==void 0&&(o.textContent=t.total_users.toLocaleString());const r=e[1].querySelector(".stat-number");r&&t.total_categories!==void 0&&(r.textContent=t.total_categories.toLocaleString());const a=e[2].querySelector(".stat-number");a&&t.total_products!==void 0&&(a.textContent=t.total_products.toLocaleString());const s=e[3].querySelector(".stat-number");s&&t.total_orders!==void 0&&(s.textContent=t.total_orders.toLocaleString());const i=e[4].querySelector(".stat-number");i&&t.total_feedbacks!==void 0&&(i.textContent=t.total_feedbacks.toLocaleString())}}).catch(t=>{document.querySelectorAll(".stat-number").forEach(o=>{const r=parseInt(o.textContent.replace(/,/g,""));if(!isNaN(r)){const a=Math.floor(Math.random()*3)-1,s=Math.max(0,r+a);o.textContent=s.toLocaleString()}})})}logout(){}}function c(n){window.location.href=`/language/${n}`}function d(){window.adminPanel&&typeof window.adminPanel.loadWeeklyCharts=="function"?window.adminPanel.loadWeeklyCharts():setTimeout(d,50)}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".lang-option").forEach(n=>{n.addEventListener("click",t=>{t.preventDefault();const e=t.target.closest(".lang-option").getAttribute("data-lang");c(e)})}),window.adminPanel=new l,window.loadWeeklyCharts=d});
